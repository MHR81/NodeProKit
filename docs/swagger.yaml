openapi: 3.0.0
info:
  title: NodeProKit API
  description: >
    Complete backend API with Node.js, Express, MongoDB, and local file storage.
    Features: Authentication, User profiles with avatars, Products with multiple images, File management.
    All responses follow standard format with success status, data, and message fields.
  version: 1.0.0
  contact:
    name: API Support
  license:
    name: MIT

servers:
  - url: http://localhost:5000
    description: Local development server
  - url: https://example.com
    description: Production server

tags:
  - name: Health
    description: API health check
  - name: Files
    description: File upload, retrieval, and management
  - name: Auth
    description: Authentication and registration
  - name: Users
    description: User profiles with avatars and admin management
  - name: Products
    description: Product management with multiple images

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT Bearer token for authenticated endpoints

paths:
  /api/health:
    get:
      tags:
        - Health
      summary: API health check
      description: Check if API is running and database is connected
      operationId: getHealthApi
      responses:
        "200":
          description: API is running
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                example:
                  success: true
                  message: "ðŸš€API is running..."

  /api/auth/register:
    post:
      tags:
        - Auth
      summary: Register - Request OTP
      description: Start registration process by requesting OTP code
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - phone
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: "user@example.com"
                phone:
                  type: string
                  example: "09123456789"
                password:
                  type: string
                  format: password
                  example: "Password123!"
      responses:
        "200":
          description: OTP sent successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      phone:
                        type: string
                      code:
                        type: string
                example:
                  success: true
                  message: "OTP sent successfully"
                  data:
                    phone: "09123456789"
                    code: "123456"
        "400":
          description: Missing required fields or user already exists
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                example:
                  success: false
                  message: "Phone and password are required"

  /api/auth/verify-otp:
    post:
      tags:
        - Auth
      summary: Register - Verify OTP
      description: Verify OTP code to complete registration
      operationId: verifyOtp
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - phone
                - code
              properties:
                phone:
                  type: string
                  example: "09123456789"
                code:
                  type: string
                  example: "123456"
      responses:
        "201":
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                example:
                  success: true
                  message: "Registered successfully"
                  data:
                    id: "507f1f77bcf86cd799439015"
        "400":
          description: Invalid OTP

  /api/auth/login:
    post:
      tags:
        - Auth
      summary: Login user
      description: Login with email or phone and password
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                  example: "user@example.com"
                phone:
                  type: string
                  example: "09123456789"
                password:
                  type: string
                  format: password
                  example: "Password123!"
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      accessToken:
                        type: string
                      refreshToken:
                        type: string
                example:
                  success: true
                  message: "Login successful"
                  data:
                    accessToken: "eyJhbGciOiJIUzI1NiIs..."
                    refreshToken: "eyJhbGciOiJIUzI1NiIs..."
        "401":
          description: Invalid credentials

  /api/auth/forgot-password:
    post:
      tags:
        - Auth
      summary: Forgot password - Request OTP
      description: Request OTP code to reset password
      operationId: forgotPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  example: "user@example.com"
      responses:
        "200":
          description: OTP sent successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      email:
                        type: string
                      code:
                        type: string
                example:
                  success: true
                  message: "OTP sent successfully"
                  data:
                    email: "user@example.com"
                    code: "123456"
        "400":
          description: Invalid email or user not found
        "429":
          description: Too many requests - Rate limited

  /api/auth/reset-password:
    post:
      tags:
        - Auth
      summary: Reset password
      description: Reset password using OTP code
      operationId: resetPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - code
                - newPassword
              properties:
                email:
                  type: string
                  format: email
                  example: "user@example.com"
                code:
                  type: string
                  example: "123456"
                newPassword:
                  type: string
                  format: password
                  example: "NewPassword123!"
      responses:
        "200":
          description: Password reset successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                example:
                  success: true
                  message: "Password reset successfully"
        "400":
          description: Invalid OTP or email

  /api/auth/logout:
    post:
      tags:
        - Auth
      summary: Logout user
      description: Logout current user (invalidate token)
      operationId: logout
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                example:
                  success: true
                  message: "Logout successful"
        "401":
          description: Unauthorized

  /api/files:
    post:
      tags:
        - Files
      summary: Upload file
      description: Upload a file to server storage
      operationId: uploadFile
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: File to upload
      responses:
        "200":
          description: File uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                      filename:
                        type: string
                example:
                  success: true
                  message: "File uploaded successfully"
                  data:
                    id: "507f1f77bcf86cd799439011"
                    filename: "image.jpg"
        "401":
          description: Unauthorized

  /api/files/{id}:
    get:
      tags:
        - Files
      summary: Get file metadata
      description: Get file information from database
      operationId: getFileById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: File found
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      _id:
                        type: string
                      filename:
                        type: string
                      filePath:
                        type: string
                      fileSize:
                        type: number
                      mimeType:
                        type: string
                      uploadedBy:
                        type: string
                      createdAt:
                        type: string
                        format: date-time
                example:
                  success: true
                  data:
                    _id: "507f1f77bcf86cd799439011"
                    filename: "image.jpg"
                    filePath: "1702979234507abc123.jpg"
                    fileSize: 3000000
                    mimeType: "image/jpeg"
                    uploadedBy: "507f1f77bcf86cd799439015"
                    createdAt: "2024-01-01T10:00:00Z"
        "404":
          description: File not found

    delete:
      tags:
        - Files
      summary: Delete file (admin)
      description: Delete file from storage and database
      operationId: deleteFile
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: File deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        "403":
          description: Forbidden (admin only)
        "404":
          description: File not found

  /api/products:
    get:
      tags:
        - Products
      summary: Get all products
      description: Get list of all products with images (public endpoint)
      operationId: getAllProducts
      responses:
        "200":
          description: Products list
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        _id:
                          type: string
                        name:
                          type: string
                        description:
                          type: string
                        price:
                          type: number
                        stock:
                          type: number
                        images:
                          type: array
                          items:
                            type: object
                            properties:
                              _id:
                                type: string
                              filePath:
                                type: string
                        createdAt:
                          type: string
                          format: date-time
                example:
                  success: true
                  data:
                    - _id: "607f1f77bcf86cd799439014"
                      name: "Laptop"
                      description: "High-performance laptop"
                      price: 1200
                      stock: 15
                      images:
                        - _id: "507f1f77bcf86cd799439011"
                          filePath: "1702979234507abc123.jpg"
                      createdAt: "2024-01-01T10:00:00Z"

    post:
      tags:
        - Products
      summary: Create product (admin)
      description: Create new product with images
      operationId: addProduct
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - price
              properties:
                name:
                  type: string
                  example: "Laptop"
                description:
                  type: string
                  example: "High-performance laptop"
                price:
                  type: number
                  example: 1200
                stock:
                  type: number
                  example: 15
                imageFileIds:
                  type: array
                  items:
                    type: string
                  example: ["507f1f77bcf86cd799439011", "507f1f77bcf86cd799439012"]
      responses:
        "200":
          description: Product created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      _id:
                        type: string
                      name:
                        type: string
                      price:
                        type: number
                      stock:
                        type: number
                      images:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                            filePath:
                              type: string
                example:
                  success: true
                  message: "Product created successfully"
                  data:
                    _id: "607f1f77bcf86cd799439014"
                    name: "Laptop"
                    price: 1200
                    stock: 15
                    images:
                      - _id: "507f1f77bcf86cd799439011"
                        filePath: "1702979234507abc123.jpg"
        "400":
          description: Invalid input
        "401":
          description: Unauthorized
        "403":
          description: Forbidden (admin only)

  /api/products/{id}:
    get:
      tags:
        - Products
      summary: Get product by ID
      description: Get details of a specific product
      operationId: getProductById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Product details
        "404":
          description: Product not found

    put:
      tags:
        - Products
      summary: Update product (admin)
      description: Update product details and/or images
      operationId: editProduct
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
                price:
                  type: number
                stock:
                  type: number
                imageFileIds:
                  type: array
                  items:
                    type: string
                  description: "Send new array to replace all images"
                  example: ["507f1f77bcf86cd799439011"]
      responses:
        "200":
          description: Product updated
        "400":
          description: Invalid input
        "404":
          description: Product not found

    delete:
      tags:
        - Products
      summary: Delete product (admin)
      description: Delete a product
      operationId: deleteProduct
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Product deleted
        "404":
          description: Product not found

  /api/users/me:
    get:
      tags:
        - Users
      summary: Get my profile
      description: Get current user profile with avatar
      operationId: getMyProfile
      security:
        - bearerAuth: []
      responses:
        "200":
          description: User profile
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      _id:
                        type: string
                      email:
                        type: string
                      phone:
                        type: string
                      role:
                        type: string
                      avatars:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                            filePath:
                              type: string
                      createdAt:
                        type: string
                        format: date-time
                example:
                  success: true
                  data:
                    _id: "507f1f77bcf86cd799439015"
                    email: "user@example.com"
                    phone: "09123456789"
                    role: "user"
                    avatars:
                      - _id: "507f1f77bcf86cd799439011"
                        filePath: "1702979234507abc123.jpg"
                    createdAt: "2024-01-01T10:00:00Z"
        "401":
          description: Unauthorized

    put:
      tags:
        - Users
      summary: Update my profile
      description: Update email, phone, password, or avatar
      operationId: editMyProfile
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                phone:
                  type: string
                password:
                  type: string
                  format: password
                avatarFileId:
                  type: string
                  description: File ID from POST /files
                  example: "507f1f77bcf86cd799439011"
      responses:
        "200":
          description: Profile updated
        "400":
          description: Invalid input or file not found
        "401":
          description: Unauthorized

  /api/users:
    get:
      tags:
        - Users
      summary: Get all users (admin)
      description: List all users with their avatars
      operationId: getAllUsers
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Users list
        "401":
          description: Unauthorized
        "403":
          description: Forbidden (admin only)

  /api/users/{id}:
    get:
      tags:
        - Users
      summary: Get user by ID (admin)
      description: Get details of a specific user
      operationId: getUserById
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: User details
        "401":
          description: Unauthorized
        "403":
          description: Forbidden (admin only)
        "404":
          description: User not found

    put:
      tags:
        - Users
      summary: Update user (admin)
      description: Update user details, role, or avatar
      operationId: editUserByAdmin
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                phone:
                  type: string
                password:
                  type: string
                  format: password
                role:
                  type: string
                  enum: [user, admin]
                avatarFileId:
                  type: string
                  example: "507f1f77bcf86cd799439011"
      responses:
        "200":
          description: User updated
        "400":
          description: Invalid input
        "401":
          description: Unauthorized
        "403":
          description: Forbidden (admin only)

    delete:
      tags:
        - Users
      summary: Delete user (admin)
      description: Delete a user
      operationId: deleteUserByAdmin
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: User deleted
        "401":
          description: Unauthorized
        "403":
          description: Forbidden (admin only)
        "404":
          description: User not found
